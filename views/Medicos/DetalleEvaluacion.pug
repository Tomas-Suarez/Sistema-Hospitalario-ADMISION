extends ../layout

block head
  link(rel="stylesheet", href="/css/VistaMedico.css")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js")

block scripts
  script(src="/js/DescargarPDF.js")

block content
  .contenido-medico
    div(style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; max-width: 800px; margin-left: auto; margin-right: auto;")
      a(href=`/evaluaciones/crear/${admision.id_admision}`, style="text-decoration: none; color: #666; font-weight: bold;") 
        | ← Volver a la Historia Clínica
      
      button.btn-pdf.btn-descargar-pdf(
        type="button",
        data-target="documento-pdf", 
        data-filename=`Evolucion_${admision.paciente.apellido}_${evaluacion.id_evaluacion_medica}.pdf`
      )
        img(src="/img/icon-admision.png", style="width: 16px; filter: brightness(0) invert(1);") 
        | Descargar PDF

    #documento-pdf.detalle-container
      
      div(style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #0277bd; padding-bottom: 20px; margin-bottom: 20px;")
        div
          h1(style="margin: 0; color: #0277bd; font-size: 24px;") Informe de Evolución
          span(style="color: #666;") Hospital San Vital
        div(style="text-align: right;")
          strong Fecha: 
          | #{new Date(evaluacion.fecha).toLocaleDateString('es-AR')}
          br
          small Hora: #{new Date(evaluacion.fecha).toLocaleTimeString('es-AR')}

      div(style="background-color: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px;")
        h3(style="margin-top: 0; color: #0d47a1; font-size: 16px; margin-bottom: 10px;") DATOS DEL PACIENTE
        div(style="display: grid; grid-template-columns: 1fr 1fr;")
          div
            strong Paciente: 
            | #{admision.paciente.apellido}, #{admision.paciente.nombre}
          div
            strong DNI: 
            | #{admision.paciente.documento}

      .label-dato PROFESIONAL A CARGO
      .valor-dato #{evaluacion.medico.apellido}, #{evaluacion.medico.nombre} (Mat. #{evaluacion.medico.matricula})

      .label-dato EVOLUCIÓN CLÍNICA
      .valor-dato(style="background: #fff; border: none; padding: 0; text-align: justify; line-height: 1.5;") 
        p(style="white-space: pre-line;") #{evaluacion.observaciones || 'Sin observaciones registradas.'}

      .label-dato INDICACIONES / TRATAMIENTOS
      if evaluacion.Tratamientos && evaluacion.Tratamientos.length > 0
        each t in evaluacion.Tratamientos
          div.box-tratamiento
            h4(style="margin: 0 0 5px 0; color: #17a2b8;")= t.nombre
            p(style="margin: 0; font-size: 0.9em; color: #555;")= t.descripcion
            if t.duracion
              small(style="display:block; margin-top:5px; color: #888;") Duración: #{t.duracion}
      else
        p(style="color: #999; font-style: italic;") No se indicaron tratamientos en esta evolución.

      .label-dato SOLICITUD DE ESTUDIOS
      if evaluacion.SolicitudPruebas && evaluacion.SolicitudPruebas.length > 0
        each p in evaluacion.SolicitudPruebas
          div.box-tratamiento(style="border-left: 4px solid #ffc107;")
            h4(style="margin: 0; color: #856404;")= p.nombre_prueba
      else
        p(style="color: #999; font-style: italic;") No se solicitaron estudios en esta evolución.
      
      div(style="margin-top: 60px; display: flex; justify-content: flex-end; page-break-inside: avoid;")
        div(style="text-align: center; width: 200px; border-top: 1px solid #333; padding-top: 5px;")
          small Firma del Profesional