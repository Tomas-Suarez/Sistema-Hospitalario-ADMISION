extends ../layout

block head
  link(rel="stylesheet", href="/css/VistaMedico.css")
  link(rel="stylesheet", href="/css/CargarEvaluacion.css") 
  link(rel="stylesheet", href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css")

block scripts
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")
  script(src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js")
  script(src="/js/DataTableGlobal.js")

block content
  .contenido-medico
    
    div(style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;")
      h1 Historial Médico de la Internación
      a(href="javascript:history.back()", style="background-color: #6c757d; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold;") Volver

    .form-card(style="background-color: #e3f2fd; border-left: 6px solid #2196f3; margin-bottom: 20px; width: 100%; max-width: 100%; box-sizing: border-box; padding: 20px;")
      h2(style="margin-top: 0; color: #0d47a1;") #{admision.paciente.apellido}, #{admision.paciente.nombre}
      div(style="display: flex; justify-content: space-between; color: #333; margin-top: 10px;")
        p: strong DNI: #{admision.paciente.documento}
        p: strong Ingreso: #{new Date(admision.fecha_entrada).toLocaleDateString('es-AR')}
        p 
          strong Estado: 
          if admision.estado
            span(style="color: green; font-weight: bold;") Internado
          else
            span(style="color: red; font-weight: bold;") Alta (#{admision.fecha_salida ? new Date(admision.fecha_salida).toLocaleDateString('es-AR') : '-'})

    .form-card(style="background-color: #ffffff; width: 100%; max-width: 100%; box-sizing: border-box; padding: 20px;")
      h3(style="margin-top: 0; margin-bottom: 15px;") Evoluciones Registradas
      
      table#TablaMedico.datatable-estandar(style="width: 100%;")
        thead
          tr
            th Fecha
            th Médico
            th Resumen
            th Acciones
        tbody
          if historial && historial.length > 0
            each ev in historial
              tr
                td(data-sort=ev.fecha)= new Date(ev.fecha).toLocaleString('es-AR')
                td= ev.medico ? ev.medico.apellido : '-'
                
                td
                  if ev.observaciones
                    | #{ev.observaciones.substring(0, 50)}#{ev.observaciones.length > 50 ? '...' : ''}
                  else
                    i(style="color: #999;") Sin observaciones

                td
                  a.btn-ver-detalle(
                    href=`/evaluaciones/detalle/${ev.id_evaluacion_medica}`,
                    style="text-decoration: none;"
                  ) 
                    span.informacion-boton
                      img.icono-info(src="/img/icon-info.png", alt="ver")
                      |  Ver Detalle