extends ../layout

block head
  title Gestión de Habitaciones
  link(rel="stylesheet", href="/css/VistaMedico.css")
  link(rel="stylesheet", href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css")

block scripts
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")
  script(src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js")
  script(src="/js/DataTableGlobal.js")

block content
  .contenido-medico
    h1 Gestión de Habitaciones

    table#TablaMedico.datatable-estandar
      thead
        tr
          th Habitación
          th Ala
          th Capacidad
          th Detalle de Camas
          th Acciones
      tbody
        each habitacion in habitaciones
          tr
            td(style="font-size: 1.1em; font-weight: bold;")= habitacion.numero
            td= habitacion.Ala.nombre
            td= habitacion.capacidad
            
            td
              if habitacion.Camas && habitacion.Camas.length > 0
                div(style="display: flex; flex-direction: column; gap: 8px;")
                  each cama in habitacion.Camas
                    div(style="display: flex; align-items: center; gap: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 4px;")
                      strong(style="color: #555;") Cama #{cama.numero}:
                      +estadoCamaTexto(cama)
              else
                span(style="color: #999;") Sin camas registradas

            td
              if habitacion.Camas && habitacion.Camas.length > 0
                div(style="display: flex; flex-direction: column; gap: 8px;")
                  each cama in habitacion.Camas
                    div(style="height: 24px; display: flex; align-items: center;") 
                      if cama.libre && !cama.higienizada
                        form(method="POST", action=`/habitaciones/higienizar/${cama.id_cama}`)
                          button.btn-accion(
                            type="submit", 
                            style="background-color: #ef6c00; color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.85em; display: flex; align-items: center; gap: 5px; font-weight: bold;"
                          )
                            | Higienizar
                      else
                        span(style="color: transparent; user-select: none;") -

mixin estadoCamaTexto(cama)
  if !cama.libre
    if cama.AsignacionDormitorios && cama.AsignacionDormitorios.length > 0
      - const paciente = cama.AsignacionDormitorios[0].Admision.Paciente
      span(style="color: #d32f2f; font-weight: bold;") Ocupada (#{paciente.apellido}, #{paciente.nombre})
    else
      span(style="color: #d32f2f; font-weight: bold;") Ocupada
  else
    if !cama.higienizada
      span(style="color: #f57c00; font-weight: bold;") A higienizar
    else
      span(style="color: #2e7d32; font-weight: bold;") Disponible