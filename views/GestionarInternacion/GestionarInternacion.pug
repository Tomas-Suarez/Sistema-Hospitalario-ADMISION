extends ../layout

block head
  link(rel="stylesheet", href="/css/GestionInternacion.css")
  link(rel="stylesheet", href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css")

block scripts
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")
  script(src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js")
  script(src="/js/DataTableGlobal.js")
  script(src="/js/GestionInternacion.js")

block content
  .contenido-internacion
    h1 Lista de Internaciones
    
    table#TablaInternaciones.datatable-estandar
      thead
        tr
          th Documento
          th Nombre
          th Apellido
          th Ala
          th N° Habitación
          th N° Cama
          th Acciones
      tbody
        each internacion in internaciones
          tr
            td= internacion.admision.paciente.documento
            td= internacion.admision.paciente.nombre
            td= internacion.admision.paciente.apellido
            td= internacion.cama.habitacion.ala.nombre
            td= internacion.cama.habitacion.numero
            td= internacion.cama.numero
            td(style="display: flex; gap: 5px; flex-wrap: wrap;")
              
              if internacion.admision.paciente.documento == '99999999'
                button.btn-identificar(
                  type="button",
                  data-idadmision=internacion.admision.id_admision
                )
                  img.icono-info(src="/img/icon-editar.png", alt="Identificar", style="width: 16px; filter: brightness(0) invert(1); margin-right: 5px;")
                  | Identificar

              button.btn-cambiar-habitacion(
                type="button",
                data-idadmision=internacion.admision.id_admision,
                data-idpaciente=internacion.admision.paciente.id_paciente
              )
                img.icono-info(src="/img/icon-crearPaciente.png", alt="Cambiar habitación")
                |  Cambiar de habitación

    #modal-identificar.hidden.modal-overlay
      .modal-content(style="border-top: 5px solid #ff9800;")
        h2(style="color: #f57c00; margin-top:0;") Identificar Paciente NN
        p(style="color: #666; font-size: 0.9em; margin-bottom: 20px;") 
          | Ingrese el DNI del paciente real para asignar esta internación.
          br
          strong(style="color: #d32f2f;") Importante: 
          | El paciente ya debe estar registrado en el sistema.

        form(action="/admisiones/identificar" method="POST")
          input(type="hidden", name="id_admision", id="input-id-admision-identificar")
          
          div(style="margin-bottom: 20px;")
            label(for="dni_real" style="display:block; font-weight:bold; margin-bottom:5px;") DNI Real del Paciente:
            input(type="text", name="dni_real", required, placeholder="Ej: 12345678", style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1.1em;")

          div(style="text-align: right; border-top: 1px solid #eee; padding-top: 15px;")
            button#cerrar-modal-identificar(type="button", style="margin-right: 10px; padding: 10px 20px; background: #eee; border: none; border-radius: 4px; cursor: pointer;") Cancelar
            button(type="submit", style="background-color: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer;") Asignar Identidad

    #modal-cambio-habitacion.hidden.modal-overlay
      .modal-content(style="border-top: 5px solid #5d4037;")
        h2(style="color: #5d4037; margin-top:0;") Cambiar Habitación
        p(style="color: #666; font-size: 0.9em; margin-bottom: 20px;") Seleccione la nueva ubicación para el paciente.

        form(action="/asignaciones/cambiar" method="POST")
          input(type="hidden", name="id_admision", id="input-id-admision-cambio")
          input(type="hidden", id="input-id-paciente-cambio") 

          div(style="margin-bottom: 15px;")
            label(for="select-ala-cambio" style="display:block; font-weight:bold; margin-bottom:5px;") Nueva Ala:
            select(id="select-ala-cambio", required, style="width: 100%; padding: 8px;")
              option(disabled selected value="") -- Seleccione Ala --
              if alas
                each ala in alas
                  option(value=ala.id_ala)= ala.nombre
              else
                 option(disabled) No hay alas cargadas

          div(style="margin-bottom: 20px;")
            label(for="select-habitacion-cambio" style="display:block; font-weight:bold; margin-bottom:5px;") Nueva Habitación:
            select(name="id_habitacion", id="select-habitacion-cambio", required, disabled, style="width: 100%; padding: 8px;")
              option(disabled selected value="") -- Seleccione primero el Ala --

          div(style="text-align: right; border-top: 1px solid #eee; padding-top: 15px;")
            button(type="submit", style="background-color: #5d4037; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer;") Confirmar Cambio
            button#cerrar-modal-cambio(type="button", style="margin-right: 10px; padding: 10px 20px; background: #eee; border: none; border-radius: 4px; cursor: pointer;") Cancelar
